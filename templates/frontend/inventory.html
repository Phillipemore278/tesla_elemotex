{% extends './base.html' %}
{% load static %}
{% load humanize %}

{% block content %}

<!-- breadcrumb -->
<div class="site-breadcrumb" style="background: url(/static/frontend/assets/img/breadcrumb/01.jpg)">
    <div class="container">
        <h2 class="breadcrumb-title">Inventory List</h2>
        <ul class="breadcrumb-menu">
            <li><a href="index.html">Home</a></li>
            <li class="active">Inventory List</li>
        </ul>
    </div>
</div>
<!-- breadcrumb end -->


<!-- car area -->
<div class="car-area list bg py-120">
    <div class="container">
        <div class="row">
            <div class="col-lg-3">
                <div class="car-sidebar">
                    <div class="car-widget">
                        <div class="car-search-form">
                            <h4 class="car-widget-title">Search</h4>
                            <form action="#">
                                <div class="form-group">
                                    <input type="text" class="form-control" placeholder="Search">
                                    <button type="search"><i class="far fa-search"></i></button>
                                </div>
                            </form>
                        </div>
                    </div>
                    <div class="car-widget">
                        <h4 class="car-widget-title">Model</h4>
                        <form method="get" id="category-filter-form">
                            <ul>
                                <li>
                                    <div class="form-check">
                                            <input class="form-check-input" type="radio" id="brand" name="category" value="all" {% if selected_slug == "all" %}checked{% elif not selected_slug %}checked{% endif %}>
                                            <label class="form-check-label" for="brand"> All Models</label>
                                    </div>
                                </li>
                                {% for cat in categories %}
                                    <li>
                                        <div class="form-check">
                                            <input class="form-check-input" type="radio" name="category"
                                                value="{{ cat.slug }}" id="category_{{ cat.slug }}"
                                                {% if selected_slug == cat.slug %}checked{% endif %}>
                                            <label class="form-check-label" for="category_{{ cat.slug }}">
                                                {{ cat.name }}
                                            </label>
                                        </div>
                                    </li>
                                    
                                {% endfor %}
                            </ul>
                        </form>
                    </div>
                    <div class="car-widget">
                        <h4 class="car-widget-title">Price Range</h4>
                        <div class="price-range-box">
                            <div class="price-range-input">
                                <input type="text" id="price-amount" readonly>
                            </div>
                            <div class="price-range"></div>
                        </div>
                    </div>
                    
                    <div class="car-widget">
                        <h4 class="car-widget-title">Features</h4>
                        <ul>
                            <li>
                                <div class="form-check">
                                    <input class="form-check-input" type="checkbox" id="feature1">
                                    <label class="form-check-label" for="feature1"> Airbag - Driver</label>
                                </div>
                            </li>
                            <li>
                                <div class="form-check">
                                    <input class="form-check-input" checked="" type="checkbox" id="feature2">
                                    <label class="form-check-label" for="feature2"> Airbag - Passenger</label>
                                </div>
                            </li>
                            <li>
                                <div class="form-check">
                                    <input class="form-check-input" type="checkbox" id="feature3">
                                    <label class="form-check-label" for="feature3"> Alloy Wheels</label>
                                </div>
                            </li>
                            <li>
                                <div class="form-check">
                                    <input class="form-check-input" type="checkbox" id="feature4">
                                    <label class="form-check-label" for="feature4"> Anti-lock Braking System</label>
                                </div>
                            </li>
                        </ul>
                    </div>
                </div>
            </div>
            <div class="col-lg-9">
                <div class="col-md-12">
                    <div class="car-sort">
                        <h6>Showing {{ page_obj.paginator.count }} results for {{ selected_category_name }}</h6>
                        <div class="car-sort-list-grid">
                            <!-- <a class="car-sort-grid" href="listing-grid.html"><i
                                    class="far fa-grid-2"></i></a> -->
                            <a class="car-sort-list active" href="{% url 'frontend:inventory' %}"><i class="far fa-list-ul"></i></a>
                        </div>
                        <div class="col-md-3 car-sort-box">
                            <select class="select">
                                <option value="1">All</option>
                                <option value="5">Sort By Model</option>
                                <option value="2">Sort By Color</option>
                                <option value="3">Sort By Year</option>
                                <option value="4">Sort By High Price</option>
                            </select>
                        </div>
                    </div>
                </div>
                <div class="row">
                    {% for car in car_list %}
                        <div class="col-md-6 col-lg-12">
                            <div class="car-item">
                                <div class="car-img">
                                    {% if car.is_on_promo %}
                                        <span class="car-status status-2">Promo</span>
                                    {% endif %}
                                    {% if car.featured_image %}
                                        <img src="{{car.featured_image.image.url}}" alt="{{car..featured_image.alt_text}}">
                                    {% else %}
                                        <img src="{% static 'images/placeholder.png' %}" alt="No image available">
                                    {% endif %}
                                    <div class="car-btns">
                                        <a href="#"><i class="far fa-heart"></i></a>
                                        <a href="#"><i class="far fa-arrows-repeat"></i></a>
                                    </div>
                                </div>
                                <div class="car-content">
                                    <div class="car-top">
                                        <h4><a href="#">{{car.title}} | {{car.category.model}}</a></h4>
                                        <!-- <div class="car-rate">
                                            <i class="fas fa-star"></i>
                                            <i class="fas fa-star"></i>
                                            <i class="fas fa-star"></i>
                                            <i class="fas fa-star"></i>
                                            <i class="fas fa-star"></i>
                                            <span>5.0 (58.5k Review)</span>
                                        </div> -->
                                    </div>
                                    <ul class="car-list">
                                        <li><i class="far fa-steering-wheel"></i>{{car.miles}}</li>
                                        <li><i class="far fa-road"></i>{{car.car_range}}</li>
                                        <li><i class="far fa-car"></i>Year: {{car.year}}</li>
                                        <li><i class="far fa-steering-wheel"></i>{{car.top_speed}}</li>
                                    </ul>
                                    <p>
                                        {{car.description}}
                                    </p>
                                    <div class="car-footer">
                                        <span class="car-price">${{car.price|intcomma}}</span>
                                        <a href="{% url 'frontend:single_car_details' car.slug %}" class="theme-btn"><span class="far fa-eye"></span>Order Now</a>
                                    </div>
                                </div>
                            </div>
                        </div>
                    {% endfor %}
                <!-- pagination -->
                <div class="pagination-area">
                    <div aria-label="Page navigation example">
                        <ul class="pagination">
                            {% if page_obj.has_previous %}
                                <li class="page-item">
                                    <a class="page-link" href="?page={{ page_obj.previous_page_number }}&category={{ selected_slug }}" aria-label="Previous">
                                        <span aria-hidden="true"><i class="far fa-arrow-left"></i></span>
                                    </a>
                                </li>
                            {% endif %}
                        
                            {# Show first page and leading ellipsis if needed #}
                            {% if 1 not in custom_page_range %}
                                <li class="page-item"><a class="page-link" href="?page=1&category={{ selected_slug }}">1</a></li>
                                {% if 2 not in custom_page_range %}
                                    <li class="page-item disabled"><span class="page-link">…</span></li>
                                {% endif %}
                            {% endif %}
                        
                            {# Loop through the smart range #}
                            {% for i in custom_page_range %}
                                <li class="page-item {% if i == page_obj.number %}active{% endif %}">
                                    <a class="page-link" href="?page={{ i }}&category={{ selected_slug }}">{{ i }}</a>
                                </li>
                            {% endfor %}
                        
                            {# Show trailing ellipsis and last page if needed #}
                            {% if total_pages not in custom_page_range %}
                                {% if total_pages|add:"-1" not in custom_page_range %}
                                    <li class="page-item disabled"><span class="page-link">…</span></li>
                                {% endif %}
                                <li class="page-item"><a class="page-link" href="?page={{ total_pages }}&category={{ selected_slug }}">{{ total_pages }}</a></li>
                            {% endif %}
                        
                            {% if page_obj.has_next %}
                                <li class="page-item">
                                    <a class="page-link" href="?page={{ page_obj.next_page_number }}&category={{ selected_slug }}" aria-label="Next">
                                        <span aria-hidden="true"><i class="far fa-arrow-right"></i></span>
                                    </a>
                                </li>
                            {% endif %}
                        </ul>
                        
                        
                    </div>
                </div>
                <!-- pagination end -->
            </div>
        </div>
    </div>
</div>
<!-- car area end -->


<script>
    document.querySelectorAll('.form-check-input').forEach(input => {
        input.addEventListener('change', () => {
            document.getElementById('category-filter-form').submit();
        });
    });
</script>
{% endblock %}